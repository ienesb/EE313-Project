\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{EE313 Project Final Report}

\author{\IEEEauthorblockN{Ahmet Caner Akar}
\IEEEauthorblockA{\textit{Electrical and Electronics Engineering Department} \\
\textit{Middle East Technical University}\\
Ankara, Turkey \\
e244228@metu.edu.tr}
\and
\IEEEauthorblockN{İsmail Enes Bülbül}
\IEEEauthorblockA{\textit{Electrical and Electronics Engineering Department} \\
\textit{Middle East Technical University}\\
Ankara, Turkey \\
e244263@metu.edu.tr}
\and
}

\maketitle

\begin{abstract}
This document is about the end-term project of EE313 Analog Electronics Laboratory, namely design of an optical wireless communication system: photophone. Background theoretical knowledge, literature research and various work about design methods and mathematical analysis of them related to this project together with simulation and experimental results are defined in this document. 
\end{abstract}

% \begin{IEEEkeywords}
% component, formatting, style, styling, insert
% \end{IEEEkeywords} 

\section{Introduction}
Communication is an integral part of our lives for us humans, who are social beings. While this communication was carried out by methods such as pigeons or fire in history, various types of communication have emerged with the advancement of technology. In this project, we will examine the one of the modern communication systems: optical wireless communication system. The overall diagram of the project is given in Figure 1, below for better understanding.\\ \par
The aim of the project is to transmit the audio input signal that is generated by the microphone and to receive this information wirelessly. Then, the received signal is fed to the speaker at the final step while the quality of the signal is indicated by a single RGB LED. In general, the project can be grouped under two main units: Transmitter Unit and Receiver Unit, as it can be seen in Figure 1. Also, each main part consists of different sub-units, and they are explained in detail in the following sections of the report.
\section{Rules}
\noindent Maximum allowed DC Voltage: ±15 Volts. \\
Instruments not allowed using: 6V terminal of the DC supply.\\ 
Frequency Range for Reference Signal: 10 kHz – 30 kHz. \\
Component not allowed to be used: audio op-amps, microphone with integrated driving circuitries, infrared and ultraviolet lasers, and visible light lasers whose power \(>\) 5mW.
\section{Transmitter Unit}
\subsection{Microphone Driver}
The first part of the transmitter unit is microphone driver circuit. To transmit an audio signal using a laser, we need to detect this audio signal first. Therefore, to do this we used an electret microphone. It requires a biasing voltage to operate. Thus, we biased the microphone by connecting the positive terminal of it to the 1 k\(\Omega\) resistor. However, since the output voltage of the microphone is quite low, we cannot directly connect it to the rest of the circuit. In order to use this output, first, we should amplify it with a non-inverting amplifier circuit as shown in Figure 2. \\ \par
There is a 10 k\(\Omega\) potentiometer connected between ground and the inverting input of the amplifier so that by changing its value, the gain can be adjusted, and the amplitude of the output signal is changed. The gain of the topology can be found by the following expression, Gain = (R\(_3\)+R\(_4\))/R\(_4\). 
Also, the simulation result of the input-output characteristics of the microphone driving circuit in LTspice is given in Figure 3 when R\(_4\) = 10k\(\Omega\). \\ \par
After non-inverting amplifier circuit, we connected a buffer circuit so that the microphone driver will not be affected from the rest of the circuit. 
\subsection{Automatic Gain Control}
The second sub-unit of the transmitter part is Automatic Gain Control (AGC). We should adjust the output signal of the microphone driver circuit because the output of the microphone is distance and frequency dependent, so the output amplitude of the microphone change with time as well as distance of the speaker (person) to it. Therefore, as it is stated in project definition, we need an automatic gain controller that controls gain and adjusts the amplitude of the microphone signal so that we will get a relatively constant amplitude audio signal at the output of the AGC regardless of the amplitude of the input signal. To achieve this, we construct the AGC circuit which can be seen in Figure 4.
\subsection{Low-Pass Filter}
\subsection{Summing Amplifier}
Before transmitting the audio signal, we are going to add another signal namely reference signal so that at the receiver side, the amplitude of this signal will be treated as the measure of signal strength since it is constant. To sum up these two signals, we used a basic summing amplifier circuit which can be seen in Figure x. 
\subsection{Laser Driver}
\section{Receiver Unit}
\subsection{Photodiode}
\subsection{Low-Pass and High-Pass Filter}
After the light signal is converted to voltage signal, we need to seperate audio signal and reference signal. We need to implement 
a low-pass filter to obtain audio signal and a high-pass filter to obtain reference signal. We decided to use a fourth order Butterworth 
Filter [x] for low-pass filter and second order Butterworth Filter for high-pass filter. The schematics of the filters are shown below. 
%% SCHEMATICs

\subsection{Improved Peak Detector}
At the proposal report, we decided to use a simple circuit with one diode and one capacitor to obtain the amplitude 
of the reference signal and it worked properly at the simulations. However, in practical case, it did not work as we expected 
since the frequency (20kHz) of the signal is too high. Therefore, we changed our design and used the circuit shown in [x] which is 
shown in the figure below. \\
%% SCHEMATIC
The simulation results for the peak detector circuit is shown below.
%% RESULTS
\subsection{Signal Level Indicator}
We are expected to design a circuit to represent received signal level with a single RGB led. Chosen colors for 
each case are shown in the table below.
\begin{table}[htbp]
    \caption{Led colors for each case}
    \begin{center}
    \begin{tabular}{|c|c|c|c|c|}
    \hline
    \textbf{Signal Level} & \textbf{Color}& \textbf{R Pin}& \textbf{G Pin}& \textbf{B Pin} \\
    \hline
    No Signal & - & 0 & 0 & 0\\
    \hline
    Weak Signal & Red & 1 & 0 & 0\\
    \hline
    Moderate Signal & Yellow & 1 & 1 & 0\\
    \hline
    Good Signal & Green & 0 & 1 & 0\\
    \hline
    No Signal & Blue & 0 & 0 & 1\\
    \hline
    \end{tabular}
    \label{tab1}
    \end{center}
\end{table}
The overall schematic of the signal level indicator circuit is shown below. \\
% SCHEMATIC
At first, we used 5 resistors connected in serial between Vcc and ground to divide Vcc into four different voltages 
to determine regions for each signal level case. 
Then four comparator is used to determine at which region the amplitude of the reference signal is. When the amplitude 
is at the first region, all comparators will have negative output and no color will be displayed. When the amplitude 
is at the second and third region, the first and the second comparator will have a positive output and red and yellow 
color will be displayed respectively. The output of the third comparator is substracted from the output of the first 
comparator by the difference amplifier so that the red pin will be turned off when the signal is at the fourth region 
and green color will be displayed. Similarly, the output of the last comparator is substracted from the output of the 
second comparator so that the green pin will be turned off and blue color will be displayed when the amplitude is at the 
last region. \\

We used common anode RGB led so that the led has a common ground pin. We used different resistors for each color pin of the led 
to adjust the tone of the colors. \\ 

The simulation results are shown below.\\
%% RESULTS
\subsection{Audio Amplifier}


\section{Conclusion}

\section*{References}
% peak detector
% https://www.analog.com/en/technical-articles/ltc6244-high-speed-peak-detector.html
\end{document}
